#!/bin/bash

count=1
quit=0
folder=/sys/class/leds
declare -a folderarray
menu(){
	count=1
	echo "Welcome to the LED Configuration Menu!"
	echo "======================================"
	echo "Please select an LED to configure:"
	for dir in $(ls $folder);
	do 
		echo $count. $dir
		folderarray[$count]=$dir
		let count++
	done
	echo $count. "Quit"
}

submenu(){
	subquit=0
	while [ $subquit -eq 0 ]; do
		echo ${PWD##*/}
		echo "======================================"
		echo "What would you like to do with this LED?"
		echo "1) turn on"
		echo "2) turn off"
		echo "3) associate with a system event"
		echo "4) associate with the performance of a process"
		echo "5) stop association with a process' performance"
		echo "6) quit to main menu"
		echo "Please enter a number (1-6) for your choice: "	
		read choice
		echo
		case $choice in 
			1)
				echo 1 | sudo tee brightness >/dev/null
				echo ${PWD##*/} "turned on."
				echo
				;;
			2)
				echo 0 | sudo tee brightness >/dev/null
				echo ${PWD##*/} "turned off."
				echo
				;;
			3)
				ls
				cd "trigger"
				syseventmenu
				echo
				;;
			6)
				subquit=1
				;;
			?)
				echo "Invalid option entered. Please enter again."
				echo ""
				;;
		esac
	done
}

syseventmenu(){
	declare -a syseventarray
	syseventquit=0
	while [ $syseventquit -eq 0 ]; do
		count=1
		for trigger in $(cat trigger);
		do 
			echo $count. $trigger
			syseventarray[$count]=$trigger
			let count++
		done
		echo $count. "Quit"
		read choice
		echo
		if ((1<=$choice && $choice<=$count-1))
			then
			for i in ${syseventarray[$i]}; do
				if (($choice==1))
					then
					echo "[none] "
					continue
				elif (($i==$choice))
					then
					echo ${syseventarray[$i]}"*" >trigger
					continue
				fi
				echo ${syseventarray[$i]} >trigger
			done
		elif [ $choice -eq $count ]
			then
			quit=1
		else
			echo "Invalid option entered. Please enter again."
			echo
		fi
	done
}

#Script Entry Point is here
while [ $quit -eq 0 ]; do
	menu
	read choice
	echo
	if ((1<=$choice && $choice<=$count-1))
		then
		cd $folder
		cd ${folderarray[$choice]}
		submenu
	elif [ $choice -eq $count ]
		then
		quit=1
	else
		echo "Invalid option entered. Please enter again."
		echo
	fi
done
echo "Goodbye!"
